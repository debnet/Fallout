{% load i18n l10n %}

<div class="row">
    {% for item in items %}
        {% if item.equiped == equiped %}
            {% with info=item.item %}
                <div class="col-md-4 col-sm-6 mb-3">
                    <div class="card h-100">
                        <div class="card-header">
                            <span class="card-title">{{ info.name }}</span>
                            {% if info.title %}<small class="card-subtitle mb-2 text-muted">{{ info.title }}</small>{% endif %}
                            {% if item.count > 1 %}<span class="badge badge-dark float-right">{{ item.count }}</span>{% endif %}
                        </div>
                        <div class="card-body">
                            {% with image=item.item.image thumbnail=item.item.thumbnail %}
                                {% if thumbnail %}
                                    <img class="img-fluid mx-auto d-block mb-2" src="{{ thumbnail }}">
                                {% elif image %}
                                    <img class="img-fluid mx-auto d-block mb-2"
                                         height="{{ image.height }}" width="{{ image.width }}" src="{{ image.url }}">
                                {% endif %}
                            {% endwith %}
                            <p class="card-text">
                                <small class="badge badge-primary">{{ item.charge|floatformat:2 }} {% trans "kg." %}</small>
                                <small class="badge badge-warning">{{ item.value|floatformat:2 }} {% trans "$" %}</small>
                                {% if info.clip_size %}
                                <small class="badge badge-danger">{{ item.clip_count }} / {{ info.clip_size }}</small>
                                {% endif %}
                                {% for modifier in info.modifiers.all %}
                                    <small class="badge {% if modifier.value > 0 %}badge-success{% else %}badge-danger{% endif %}">
                                        {% if modifier.value > 0 %}+{% endif %}{{ modifier.value }}
                                        {{ modifier.get_stats_display }}
                                    </small>
                                {% endfor %}
                                {% with condition=item.current_condition %}
                                    {% if condition %}
                                        <div class="progress">
                                            {% localize off %}
                                            <div role="progressbar" style="width: {{ condition }}%;" aria-valuenow="{{ condition }}"
                                                 aria-valuemin="0" aria-valuemax="100" class="progress-bar progress-bar-striped
                                                 bg-{% if condition < 25 %}danger{% elif condition < 50 %}warning{% else %}success{% endif %}">
                                            {% endlocalize %}
                                                {{ condition|floatformat:0 }}%
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endwith %}
                            </p>
                            <p class="card-text">
                                {% if info.description %}
                                    <small class="text-muted">{{ info.description }}</small>
                                {% endif %}
                            </p>
                        </div>
                        {% if request.user.is_superuser %}
                            <div class="card-footer">
                                <form class="form-inline" method="post" action="{{ request.path }}?items">
                                    {% if item.equiped %}
                                        <button class="btn btn-sm btn-danger m-1" type="submit"
                                                name="unequip">{% trans "Retirer" %}</button>
                                    {% else %}
                                        {% if info.compatible_ammunition %}
                                            <button class="btn btn-sm btn-warning m-1" type="submit"
                                                    name="replace-ammo">{% trans "Remplacer" %}</button>
                                        {% elif info.is_equipable %}
                                            <button class="btn btn-sm btn-info m-1" type="submit"
                                                    name="equip">{% trans "Equiper" %}</button>
                                        {% elif info.is_usable %}
                                            <button class="btn btn-sm btn-success m-1" type="submit"
                                                    name="use">{% trans "Utiliser" %}</button>
                                        {% endif %}
                                    {% endif %}
                                    {% if info.clip_size and item.clip_count < info.clip_size %}
                                        <button class="btn btn-sm btn-success m-1" type="submit"
                                                name="reload">{% trans "Recharger" %}</button>
                                    {% endif %}
                                    <div class="form-check m-1">
                                        <label class="form-check-label">
                                            <input class="form-check-input" type="checkbox" name="action">
                                            <small>{% trans "Action" %}</small>
                                        </label>
                                    </div>
                                    <input type="hidden" name="type" value="item" />
                                    <input type="hidden" name="item" value="{{ item.id }}" />
                                    {% csrf_token %}
                                </form>
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endwith %}
        {% endif %}
    {% endfor %}
</div>
