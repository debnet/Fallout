{% extends "fallout/base.html" %}
{% load i18n %}
{% get_current_language as LANGUAGE_CODE %}

{% block navbar %}
    {% include "fallout/navbar.html" %}
{% endblock %}

{% block actions %}
    <a class="dropdown-item" href="{% url 'admin:fallout_campaign_add' %}">{% trans "Ajouter une campagne" %}</a>
    {% if campaign %}
    <a class="dropdown-item" href="{% url 'admin:fallout_campaign_change' campaign.id %}">{% trans "Modifier la campagne" %}</a>
    {% endif %}
    <a class="dropdown-item" href="{% url 'admin:fallout_character_add' %}?campaign={{ campaign.id }}">{% trans "Ajouter un personnage" %}</a>
{% endblock %}

{% block content %}
    {% if campaign %}
        <div class="container">
            {% with image=campaign.image thumbnail=campaign.thumbnail %}
                {% if thumbnail %}
                    <img class="float-left mr-2" height="100" width="100" src="{{ thumbnail }}">
                {% elif image %}
                    <img class="float-left mr-2" height="100" width="100" src="{{ image.url }}">
                {% endif %}
            {% endwith %}
            <h4 class="display-4">
                {{ campaign.name }}
                {% if campaign.title %}<small class="text-muted">{{ campaign.title }}</small>{% endif %}
            </h4>
            {% if campaign.description %}<p class="lead">{{ campaign.description }}</p>{% endif %}
        </div>
    {% else %}
        <div class="container">
            <h4 class="display-4">
                {% trans "Aucune campagne" %}
            </h4>
            <p class="lead">
                {% blocktrans %}
                    Vous êtes actuellement sur la réserve de personnages qui ne sont associés à aucune campagne
                    particulière ainsi la plupart des actions liées à une campagne (comme la gestion du temps et les
                    effets) sont désactivés.
                {% endblocktrans %}
            </p>
        </div>
    {% endif %}
    <div role="tabpanel" id="tabs">
        <ul class="nav nav-tabs nav-justified tab" id="actions-tabs" role="tablist">
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" role="tab"
                   id="campaign-infos-tab" href="#campaign-infos">{% trans "Campagne" %}</a>
            </li>
            {% if campaign %}
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" role="tab"
                       id="campaign-effects-tab" href="#campaign-effects">{% trans "Effets" %}</a>
                </li>
            {% endif %}
            <li class="nav-item">
                <a class="nav-link" data-toggle="tab" role="tab"
                   id="campaign-loots-tab" href="#campaign-loots">{% trans "Butins" %}</a>
            </li>
        </ul>
        <div class="tab-content">
            {% include "fallout/campaign/panels/infos.html" %}
            {% include "fallout/campaign/panels/effects.html" %}
            {% include "fallout/campaign/panels/loots.html" %}
        </div>
    </div>
{% endblock %}

{% block scripts %}
    {% if campaign %}
        <script type="application/javascript">
            $(document).ready(function () {
                $("#campaign-calendar").calendar({
                    language: "{{ LANGUAGE_CODE|default:'fr' }}",
                    year: {{ campaign.current_game_date|date:'Y' }},
                    month: {{ campaign.current_game_date|date:'m' }},
                    cell_border: true,
                    show_days: true,
                    nav_icon: {
                      prev: '&lt;',
                      next: '&gt;'
                    },
                    legend: [
                        {
                            type: "text",
                            label: "{% trans "Maintenant" %}",
                            badge: "00"
                        }
                    ],
                    data: [
                        {
                            date: "{{ campaign.start_game_date|date:'Y-m-d' }}",
                            badge: false,
                            title: "{% trans "Début de la campagne" %}",
                            footer: "{{ campaign.start_game_date }}"
                        },
                        {
                            date: "{{ campaign.current_game_date|date:'Y-m-d' }}",
                            badge: true,
                            title: "{% trans "Maintenant" %}",
                            footer: "{{ campaign.current_game_date }}"
                        }
                    ]
                });
            });
        </script>
    {% endif %}
{% endblock %}
